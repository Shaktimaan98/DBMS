CREATE DATABASE lib;
USE lib;

CREATE TABLE library(
    bno INT(5),
    bname VARCHAR(40),
    author VARCHAR(20),
    allowed_days INT(5)
);

CREATE TABLE library_audit(
    bno INT(5),
    old_all_days INT(5),
    new_all_days INT(5)
);

INSERT INTO library VALUES
(1,'Database Systems','Connally T',10),
(2,'System Programming','John Donovan',20),
(3,'Computer Network & Internet','Douglas E. Comer',18),
(4,'Agile Project Management','Ken Schwaber',24),
(5,'Python for Data Analysis','Wes McKinney',12);

SELECT * FROM library;

DELIMITER //

CREATE TRIGGER tr1
BEFORE UPDATE ON library
FOR EACH ROW
BEGIN
    INSERT INTO library_audit VALUES (NEW.bno, OLD.allowed_days, NEW.allowed_days);
END;
//

DELIMITER ;

-- Perform updates
UPDATE library SET allowed_days = 15 WHERE bno = 1;
UPDATE library SET allowed_days = 25 WHERE bno = 2;
UPDATE library SET allowed_days = 13 WHERE bno = 3;
UPDATE library SET allowed_days = 19 WHERE bno = 4;
UPDATE library SET allowed_days = 17 WHERE bno = 5;

-- Check results
SELECT * FROM library;
SELECT * FROM library_audit;
